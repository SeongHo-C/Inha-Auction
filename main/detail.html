<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>상품정보상세</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <script src="detailProduct.js"></script>
    <script src="login.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="roomCreate.js" defer></script>
    <!--웹 로고-->
    <link rel="icon" type="image/x-icon" href="/images/emblem.ico" />
  </head>
  <body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container px-5 px-lg-5">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a id="login" class="nav-link" href="/member/login.html"
                >로그인</a
              >
            </li>
            <li class="nav-item">
              <a id="join" class="nav-link" href="/member/join.html"
                >회원가입</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/main/mypage.html">마이페이지</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Header-->
    <header class="p-3 mb-3 border-bottom">
      <div class="container">
        <div
          class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start ms-7"
        >
          <a
            href="/main/search.html"
            class="d-flex align-items-center mb-2 mb-lg-0 text-dark text-decoration-none"
          >
            <img
              class="bi me-2"
              src="/images/emblem.png"
              width="40"
              height="40"
            />
            <span class="fs-4">Inha Auction</span>
          </a>
          <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-5 w-40 ms-5">
            <input
              type="search"
              class="form-control"
              placeholder="Search..."
              aria-label="Search"
            />
          </form>
          <ul
            class="nav col-12 col-lg-auto mb-2 justify-content-center mb-md-0 me-lg-4 ms-6"
          >
            <li>
              <a href="/main/register.html" class="nav-link px-3 link-dark"
                >상품등록</a
              >
            </li>
            <li>
              <a href="/main/mypage.html" class="nav-link px-3 link-dark"
                >마이페이지</a
              >
            </li>
            <li><a href="#" class="nav-link px-3 link-dark">TALK!</a></li>
          </ul>
        </div>
      </div>
    </header>
    <section class="py-3">
      <div class="container px-4 px-lg-5 mt-3">
        <h2>상품명</h2>
        <hr />
        <div class="row gx-4 gx-lg-5 row-cols-xl-2 justify-content-center">
          <!--상품이미지-->
          <div class="col mb-5">
            <div
              id="carouselExampleControls"
              class="carousel slide"
              data-bs-ride="carousel"
              style="width: 85%; border: 1px solid black"
            >
              <div id="carouselInner" class="carousel-inner">
                
              </div>
              <button
                class="carousel-control-prev"
                type="button"
                data-bs-target="#carouselExampleControls"
                data-bs-slide="prev"
              >
                <span
                  class="carousel-control-prev-icon"
                  aria-hidden="true"
                ></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button
                class="carousel-control-next"
                type="button"
                data-bs-target="#carouselExampleControls"
                data-bs-slide="next"
              >
                <span
                  class="carousel-control-next-icon"
                  aria-hidden="true"
                ></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>

          <!--상품정보-->
          <div class="col mb-5">
            <div style="width: 90%;" class="ms-auto">
              <div>
                <table id="detailInfo" class="tb-w100 detail-productInfo">
                  
                </table>
              </div>
              <div class="mt-6">
                
                <button
                  id="Bid"
                  type="button"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#bidModal"
                >
                  입찰하기
                </button>
                <button id="roomCreate" type="button" class="btn btn-secondary">
                  문의하기
                </button>
                
              </div>
            </div>
          </div>
        </div>

        <!--입찰하기 MODAL!-->
        <div
          class="modal fade"
          id="bidModal"
          tabindex="-1"
          aria-labelledby="exampleModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel">입찰하기</h4>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body mb-3">
                <form id="modalForm" name="modalForm" method="post">
                  <label for="bid-price">입찰 가격</label>
                  <input type="text" id="bid-price" class="me-5" /> 
                  <label for="instantly-buy">즉시 구매가</label>
                  <input
                    type="checkbox"
                    onclick="toggleTextbox(this)"             
                  />           
              </div>
              <div class="modal-footer">
                <button type="button" id="btnBid" class="btn btn-primary" >입찰하기</button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  닫기
                </button>
              </form>
              </div>
            </div>
          </div>
        </div>

        <!-- 상품설명 -->
        <div id="productContent" style="width: 100%">
          
        </div>
        </div>
      </div>
    </section>
    <footer class="py-5 bg-dark">
      <div class="container text-white">
        <address>
          상호명 : (주)인하옥션 / 대표이사: 이성호 사장: 박인우 / 주소:
          인천광역시 미추홀구 인하로 100
          <br />Tel: 032-2369-8343 (정확한 상담을 위해 통화내용이 저장됩니다. )
        </address>
        <p>
          인하옥션에서 등록된 오픈마켓 상품은 개별판매자가 시스템을 이용하여
          등록한 것으로서 인하옥션은 등록된 상품과 그 내용에 대하여 일체의
          책임을 지지 않습니다
        </p>
        <p>Copyright(c) 2022, inhaauction,lnc All rights reserved.</p>
      </div>
    </footer>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script>
      // 즉시 구매가
      function toggleTextbox(checkbox) {
      const instantPrice_value = document.getElementById("instantPrice_value").firstChild.data.replace(',','').slice(0, -1);
        const textbox_elem = document.getElementById('bid-price');
        textbox_elem.disabled = checkbox.checked ? true : false;
        if (textbox_elem.disabled) {
          textbox_elem.value = instantPrice_value;
        } else {
          textbox_elem.value = null;
          textbox_elem.focus();
        }
      }

      // 입찰하기
      const modalForm = document.getElementById('btnBid');

      modalForm.addEventListener('click', function(e) {
        e.preventDefault();
        const instantPrice_value = Number(document.getElementById("instantPrice_value").firstChild.data.replace(',','').slice(0, -1));
        const startPrice_value = Number(document.getElementById('startPrice_value').firstChild.data.replace(',','').slice(0, -1));
        const bidUnit_value = Number(document.getElementById('bidUnit_value').firstChild.data.replace(',','').slice(0, -1));
        const bid = Number(document.getElementById('bid-price').value);
        
        console.log(startPrice_value <= bid);
        console.log(bid % bidUnit_value == 0);
        console.log(instantPrice_value < bid);
        
        if(startPrice_value <= bid) {
          if(bid % bidUnit_value == 0) {
            if(instantPrice_value >= bid) {
        const memberId = localStorage.getItem('memberId');
        fetch('http://182.218.194.156:8080/order', {
          method: 'post',
          headers: {
            'Content-Type': 'application/json',
            Authorization: 'Bearer ' + localStorage.getItem('token'),
          },
          body: JSON.stringify({
            bid: bid,
            productId: productId,
            customerId: memberId,
          }),
        }) .then(function (response) {
            return response.text();
          })
          .then(function (data) {
            console.log(data);
            location.href= '/main/detail.html?id=' + productId;
          })
          .catch(function (error) {
            console.log(error);
          });} else {
            alert('즉시 구매가를 넘었습니다.');
          }
        } else{
            alert('입찰 단위에 맞지 않습니다.');
          }
        } else {
          alert('입찰 가격이 시작가보다 낮습니다.');
        }
          
        
      })
    </script>
  </body>
</html>
